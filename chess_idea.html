
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chess Upsets Amongst Bots &#8212; My Jupyter Book</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">My Jupyter Book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1 current">
  <a class="reference internal" href="#">
   Chess Upsets Amongst Bots
  </a>
 </li>
</ul>
    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/chess_idea.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/chess_idea.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="chess-upsets-amongst-bots">
<h1><strong>Chess Upsets Amongst Bots</strong><a class="headerlink" href="#chess-upsets-amongst-bots" title="Permalink to this headline">¶</a></h1>
<p><strong>Name: Cameron Andrews</strong></p>
<p><strong>Introduction:</strong></p>
<p>This aim of this project is to explore an interesting phenomenon within the world of chess, yet it will not focus on any human chess players. Instead this project will focus on chess matches between two opposing chess engines, of different and randomly selected ELO ratings.</p>
<p>At first you may believe that the chess engine with a higher ELO rating would always win, simply because chess is known to be a game of perfect information, and therefore the more skilled engine should win against a lesser skilled engine every time. However, by simulating thousands of games under these circumstances, it is noticeable that this is not the case, and that even when there is a large discrepancy amongst the two ELOs, an upset is still possible. This project will aim to analyze the occurrence of upsets between chess engines, determine whether there may be telling signs of when an upset is possible, and attempt to train a model that can determine who is more likely to win given a board position.</p>
<p>But first, we must gather the data!</p>
<p><strong>Important Note Regarding Project Dependencies:</strong></p>
<p>During the creation of this notebook I came to the conclusion that I needed a way to significantly increase the speed of my data processing, especially since some points of this tutorial deal with over a million rows at once. Thus I have decided to utilize the RAPIDS toolkit, which allows me to utilize many of the popular Python data science libraries, but with GPU support. In my personal machine I have a NVIDIA 3080 Ti GPU, and wanted to see if I could harness its power to help speed up runtime. However, if you are without a GPU, this project can use a CPU instead, albeit it will run slower.</p>
<p>RAPIDS: <a class="reference external" href="https://rapids.ai/">https://rapids.ai/</a></p>
<p>So when you see “cudf” in this project, that is referring to the RAPIDS version of Pandas. It is functionally almost entirely the same but instead uses GPU compute power instead of CPU. This also helps later in the project when I train an XGBoost classifier, again with GPU enabled support.</p>
<p>This also means that this notebook requires a Linux environment to run. This is because the RAPIDS toolkit is currently only supported on Linux. I personally have a Windows machine, and utilized WSL2 (Windows Subsystem for Linux) to develop and run this notebook. I would recommend checking it out if interested &#64; <a class="reference external" href="https://docs.microsoft.com/en-us/windows/wsl/install">https://docs.microsoft.com/en-us/windows/wsl/install</a>.</p>
<p><strong>Data Creation:</strong></p>
<p>This project will utilize a famous chess engine called “Stockfish”, and in the process we will create two different engines; one to play the white pieces, and one for the black pieces. At the beginning of each simulation we will randomly select an ELO rating between 200 and 2500 for each engine. For reference, the highest ranked human chess player in the world, Magnus Carlsen, currently has an ELO floating around 2800.</p>
<p>First, in order to run this script you will need to have access to the Stockfish executable (Downloadable from their website &#64; <a class="reference external" href="https://stockfishchess.org/download">https://stockfishchess.org/download</a>). After downloading, you will need to specify the executable path as seen in the code below.</p>
<p>After that you should be able to run this script and generate your own chess data to analyze. However, this script takes several hours to run, and therefore the script will first check to see whether this data has already been created, and if found, will use that instead. Because the resulting CSV file is large (around 500mb), I have decided to split up the CSV into 5 smaller files, that way they can be uploaded to the Github repository and anyone interested in analyzing this data won’t have to wait for hours to have fun analyzing!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">chess</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">cudf</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">stockfish</span> <span class="kn">import</span> <span class="n">Stockfish</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="n">preexisting_data_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;Data/chess_data_*.csv&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">preexisting_data_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

    <span class="c1"># Set the number of simulations to run.</span>
    <span class="n">NUM_SIMS</span> <span class="o">=</span> <span class="mi">50000</span>
    <span class="n">chess_df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span>
                                <span class="s2">&quot;FEN&quot;</span><span class="p">,</span> <span class="s2">&quot;MOVES_DF&quot;</span><span class="p">,</span> <span class="s2">&quot;NUM_MOVE_PAIRS&quot;</span><span class="p">,</span> <span class="s2">&quot;RESULT&quot;</span><span class="p">,</span> <span class="s2">&quot;WINNER&quot;</span><span class="p">,</span> <span class="s2">&quot;WHITE_ELO&quot;</span><span class="p">,</span> <span class="s2">&quot;BLACK_ELO&quot;</span><span class="p">,</span> <span class="s2">&quot;UPSET&quot;</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_SIMS</span><span class="p">):</span>

        <span class="c1"># Configure Two StockFish Chess Engines of unique ELO ratings that will fight eachother</span>
        <span class="n">white_stockfish</span> <span class="o">=</span> <span class="n">Stockfish</span><span class="p">(</span>
            <span class="s2">&quot;stockfish_14.1_win_x64_avx2/stockfish_14.1_win_x64_avx2.exe&quot;</span><span class="p">)</span>
        <span class="n">white_elo</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">2500</span><span class="p">))</span>
        <span class="n">white_stockfish</span><span class="o">.</span><span class="n">set_elo_rating</span><span class="p">(</span><span class="n">white_elo</span><span class="p">)</span>

        <span class="n">black_stockfish</span> <span class="o">=</span> <span class="n">Stockfish</span><span class="p">(</span>
            <span class="s2">&quot;stockfish_14.1_win_x64_avx2/stockfish_14.1_win_x64_avx2.exe&quot;</span><span class="p">)</span>
        <span class="n">black_elo</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">2500</span><span class="p">))</span>
        <span class="n">black_stockfish</span><span class="o">.</span><span class="n">set_elo_rating</span><span class="p">(</span><span class="n">black_elo</span><span class="p">)</span>

        <span class="c1"># Initializing a new chess board</span>
        <span class="n">board</span> <span class="o">=</span> <span class="n">chess</span><span class="o">.</span><span class="n">Board</span><span class="p">()</span>

        <span class="c1"># Creating a new DataFrame to Keep track of all moves in the game</span>
        <span class="n">moves_df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;FEN_BEFORE_MOVE&quot;</span><span class="p">,</span> <span class="s2">&quot;MOVE_MADE&quot;</span><span class="p">,</span> <span class="s2">&quot;TURN&quot;</span><span class="p">])</span>

        <span class="c1"># Making moves until the game ends</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">board</span><span class="o">.</span><span class="n">is_game_over</span><span class="p">():</span>
            <span class="n">white_stockfish</span><span class="o">.</span><span class="n">set_fen_position</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">fen</span><span class="p">())</span>
            <span class="n">white_next_move</span> <span class="o">=</span> <span class="n">white_stockfish</span><span class="o">.</span><span class="n">get_best_move</span><span class="p">()</span>

            <span class="c1"># Appending the current move to a separate DataFrame that tracks all moves made throughout a game</span>
            <span class="n">moves_df</span> <span class="o">=</span> <span class="n">moves_df</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;FEN_BEFORE_MOVE&quot;</span><span class="p">:</span> <span class="n">board</span><span class="o">.</span><span class="n">fen</span><span class="p">(</span>
            <span class="p">),</span> <span class="s2">&quot;TURN&quot;</span><span class="p">:</span> <span class="s2">&quot;WHITE&quot;</span><span class="p">,</span> <span class="s2">&quot;MOVE_MADE&quot;</span><span class="p">:</span> <span class="n">white_next_move</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">board</span><span class="o">.</span><span class="n">push_uci</span><span class="p">(</span><span class="n">white_stockfish</span><span class="o">.</span><span class="n">get_best_move</span><span class="p">())</span>

            <span class="n">black_stockfish</span><span class="o">.</span><span class="n">set_fen_position</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">fen</span><span class="p">())</span>
            <span class="n">black_next_move</span> <span class="o">=</span> <span class="n">black_stockfish</span><span class="o">.</span><span class="n">get_best_move</span><span class="p">()</span>

            <span class="c1"># Must check if the game is already over before proceeding</span>
            <span class="k">if</span> <span class="n">black_next_move</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Appending the current move to a separate DataFrame that tracks all moves made throughout a game</span>
                <span class="n">moves_df</span> <span class="o">=</span> <span class="n">moves_df</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;FEN_BEFORE_MOVE&quot;</span><span class="p">:</span> <span class="n">board</span><span class="o">.</span><span class="n">fen</span><span class="p">(</span>
                <span class="p">),</span> <span class="s2">&quot;TURN&quot;</span><span class="p">:</span> <span class="s2">&quot;BLACK&quot;</span><span class="p">,</span> <span class="s2">&quot;MOVE_MADE&quot;</span><span class="p">:</span> <span class="n">black_next_move</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">board</span><span class="o">.</span><span class="n">push_uci</span><span class="p">(</span><span class="n">black_next_move</span><span class="p">)</span>

        <span class="c1"># Cleaning the string containing the game&#39;s outcome</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">outcome</span><span class="p">(</span><span class="n">claim_draw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">termination</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="s2">&quot;Termination.&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Checks the results of the game and sets a few different variables accordingly</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="s2">&quot;CHECKMATE&quot;</span><span class="p">:</span>

            <span class="n">upset</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">board</span><span class="o">.</span><span class="n">outcome</span><span class="p">(</span><span class="n">claim_draw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">winner</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">winner</span> <span class="o">=</span> <span class="s2">&quot;WHITE&quot;</span>

                <span class="k">if</span> <span class="n">white_elo</span> <span class="o">&lt;</span> <span class="n">black_elo</span><span class="p">:</span>
                    <span class="n">upset</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">winner</span> <span class="o">=</span> <span class="s2">&quot;BLACK&quot;</span>

                <span class="k">if</span> <span class="n">black_elo</span> <span class="o">&lt;</span> <span class="n">white_elo</span><span class="p">:</span>
                    <span class="n">upset</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">winner</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">upset</span> <span class="o">=</span> <span class="s2">&quot;N/A&quot;</span>

        <span class="c1"># Adds the game data to the main chess_df DataFrame</span>
        <span class="n">chess_df</span> <span class="o">=</span> <span class="n">chess_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;FEN&quot;</span><span class="p">:</span> <span class="n">board</span><span class="o">.</span><span class="n">fen</span><span class="p">(),</span> <span class="s2">&quot;MOVES_DF&quot;</span><span class="p">:</span> <span class="n">moves_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(),</span> <span class="s2">&quot;NUM_MOVE_PAIRS&quot;</span><span class="p">:</span> <span class="n">board</span><span class="o">.</span><span class="n">fullmove_number</span><span class="p">,</span> <span class="s2">&quot;RESULT&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span>
             <span class="s2">&quot;WINNER&quot;</span><span class="p">:</span> <span class="n">winner</span><span class="p">,</span> <span class="s2">&quot;WHITE_ELO&quot;</span><span class="p">:</span> <span class="n">white_elo</span><span class="p">,</span> <span class="s2">&quot;BLACK_ELO&quot;</span><span class="p">:</span> <span class="n">black_elo</span><span class="p">,</span> <span class="s2">&quot;UPSET&quot;</span><span class="p">:</span> <span class="n">upset</span><span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Writes the DataFrame to a CSV file</span>
    <span class="n">chess_df_1</span> <span class="o">=</span> <span class="n">chess_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">10000</span><span class="p">]</span>
    <span class="n">chess_df_2</span> <span class="o">=</span> <span class="n">chess_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">10000</span><span class="p">:</span><span class="mi">20000</span><span class="p">]</span>
    <span class="n">chess_df_3</span> <span class="o">=</span> <span class="n">chess_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">20000</span><span class="p">:</span><span class="mi">30000</span><span class="p">]</span>
    <span class="n">chess_df_4</span> <span class="o">=</span> <span class="n">chess_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">30000</span><span class="p">:</span><span class="mi">40000</span><span class="p">]</span>
    <span class="n">chess_df_5</span> <span class="o">=</span> <span class="n">chess_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">40000</span><span class="p">:</span><span class="mi">50000</span><span class="p">]</span>

    <span class="n">chess_df_1</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;Data/chess_data_1.csv&quot;</span><span class="p">)</span>
    <span class="n">chess_df_2</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;Data/chess_data_2.csv&quot;</span><span class="p">)</span>
    <span class="n">chess_df_3</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;Data/chess_data_3.csv&quot;</span><span class="p">)</span>
    <span class="n">chess_df_4</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;Data/chess_data_4.csv&quot;</span><span class="p">)</span>
    <span class="n">chess_df_5</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;Data/chess_data_5.csv&quot;</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>

    <span class="n">chess_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">preexisting_data_files</span><span class="p">:</span>
        <span class="c1"># Reading preexisting moves generated from an earlier simulation</span>
        <span class="n">temp_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">temp_df</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
        <span class="n">chess_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">chess_df</span><span class="p">,</span> <span class="n">temp_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Dropping the index column as it is repetitive</span>
    <span class="n">chess_df</span> <span class="o">=</span> <span class="n">chess_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>

<span class="c1"># Outputting the DataFrame</span>
<span class="n">chess_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FEN</th>
      <th>MOVES_DF</th>
      <th>NUM_MOVE_PAIRS</th>
      <th>RESULT</th>
      <th>WINNER</th>
      <th>WHITE_ELO</th>
      <th>BLACK_ELO</th>
      <th>UPSET</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2k1r3/Qb6/1p5p/2p4P/2P5/2B5/P2Pp3/R3Kq2 w - - ...</td>
      <td>,FEN_BEFORE_MOVE,MOVE_MADE,TURN\r\n0,rnbqkbnr/...</td>
      <td>40</td>
      <td>CHECKMATE</td>
      <td>BLACK</td>
      <td>903</td>
      <td>549</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2rqk2r/1p1b2p1/pn2pbQ1/3p1n1p/5P1P/BPp2N1N/P1P...</td>
      <td>,FEN_BEFORE_MOVE,MOVE_MADE,TURN\r\n0,rnbqkbnr/...</td>
      <td>27</td>
      <td>CHECKMATE</td>
      <td>WHITE</td>
      <td>2417</td>
      <td>2137</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2R5/5k1R/8/2K2P1P/2P5/2B5/8/b7 b - - 1 63</td>
      <td>,FEN_BEFORE_MOVE,MOVE_MADE,TURN\r\n0,rnbqkbnr/...</td>
      <td>63</td>
      <td>CHECKMATE</td>
      <td>WHITE</td>
      <td>1408</td>
      <td>233</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>r1b4r/ppb1pQk1/3qn1Bp/2p4P/5PP1/2P1N3/PP3R2/R1...</td>
      <td>,FEN_BEFORE_MOVE,MOVE_MADE,TURN\r\n0,rnbqkbnr/...</td>
      <td>21</td>
      <td>CHECKMATE</td>
      <td>WHITE</td>
      <td>2420</td>
      <td>316</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>7Q/8/7k/3K1Q2/3P3B/8/8/8 b - - 4 91</td>
      <td>,FEN_BEFORE_MOVE,MOVE_MADE,TURN\r\n0,rnbqkbnr/...</td>
      <td>91</td>
      <td>CHECKMATE</td>
      <td>WHITE</td>
      <td>1360</td>
      <td>2382</td>
      <td>True</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>49995</th>
      <td>5k2/5Q2/3P3p/p7/1qNB4/8/6PP/5R1K b - - 0 57</td>
      <td>,FEN_BEFORE_MOVE,MOVE_MADE,TURN\r\n0,rnbqkbnr/...</td>
      <td>57</td>
      <td>CHECKMATE</td>
      <td>WHITE</td>
      <td>2062</td>
      <td>1690</td>
      <td>False</td>
    </tr>
    <tr>
      <th>49996</th>
      <td>3Q1k2/5p1p/1r2b2P/4P3/4P3/2r2PK1/8/8 b - - 1 43</td>
      <td>,FEN_BEFORE_MOVE,MOVE_MADE,TURN\r\n0,rnbqkbnr/...</td>
      <td>43</td>
      <td>CHECKMATE</td>
      <td>WHITE</td>
      <td>2132</td>
      <td>267</td>
      <td>False</td>
    </tr>
    <tr>
      <th>49997</th>
      <td>5Q1R/7n/5p1k/5Pp1/6KP/8/8/8 b - - 4 63</td>
      <td>,FEN_BEFORE_MOVE,MOVE_MADE,TURN\r\n0,rnbqkbnr/...</td>
      <td>63</td>
      <td>CHECKMATE</td>
      <td>WHITE</td>
      <td>1308</td>
      <td>2206</td>
      <td>True</td>
    </tr>
    <tr>
      <th>49998</th>
      <td>8/2p1k3/1b6/n3p2P/4P3/3P1bP1/6qK/8 w - - 0 51</td>
      <td>,FEN_BEFORE_MOVE,MOVE_MADE,TURN\r\n0,rnbqkbnr/...</td>
      <td>51</td>
      <td>CHECKMATE</td>
      <td>BLACK</td>
      <td>1097</td>
      <td>1727</td>
      <td>False</td>
    </tr>
    <tr>
      <th>49999</th>
      <td>2rq3r/3R1Q2/pN3pk1/7p/B3PBpn/2P2P2/P4P2/5RK1 b...</td>
      <td>,FEN_BEFORE_MOVE,MOVE_MADE,TURN\r\n0,rnbqkbnr/...</td>
      <td>35</td>
      <td>CHECKMATE</td>
      <td>WHITE</td>
      <td>267</td>
      <td>2284</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
<p>50000 rows × 8 columns</p>
</div></div></div>
</div>
<p><strong>What Now?</strong></p>
<p>After that first cell has completed running, you should now be in possession of a Pandas DataFrame containing the results of 50,000 simulated chess matches. The DataFrame has 8 columns in total, with the first being the FEN (Forsyth–Edwards Notation, a standard way for describing board position) at the end of the game. The next column contains a CSV string representing all the individual moves made during that particular game. Now after running 50,000 simulations, we will have roughly over 6,000,000 moves to analyze. The DataFrame also contains a count of move pairs made during the match, the match result, winner, ELO rankings, and a boolean column describing whether the match ended in an upset, where the lower ranked engine beat the higher ranked.</p>
<p>So now that we have a Pandas DataFrame containing the results of our simulation, we can begin to explore the data and determine whether there are any common traits amongst games that ended in an upset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ratio of Total Games that Ended in an Upset:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ended in Upset:&quot;</span><span class="p">,</span> <span class="n">chess_df</span><span class="p">[</span><span class="s2">&quot;UPSET&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Didn&#39;t End in Upset:&quot;</span><span class="p">,</span> <span class="n">chess_df</span><span class="p">[</span><span class="s2">&quot;UPSET&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">percentage</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">chess_df</span><span class="p">[</span><span class="s2">&quot;UPSET&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">chess_df</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Percentage of Total Games that Ended in Upset: </span><span class="si">{</span><span class="n">percentage</span><span class="si">}</span><span class="s2"> %&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ratio of Total Games that Ended in an Upset:
Ended in Upset: 31286
Didn&#39;t End in Upset: 16822 

Percentage of Total Games that Ended in Upset: 33.644 %
</pre></div>
</div>
</div>
</div>
<p>Clearly it appears that a fairly significant number of games end up in an upset, and in my testing it also seems that the percentage of upsets remains around 33% regardless of the number of simulations ran.</p>
<p><strong>Plotting:</strong></p>
<p>At this point I have a variety of different hypotheses concerning the likeliness of a chess upset, so I am going to go ahead and visualize some of our data to see if there’s any truth to my ideas. To do this, I will create histogram plots of both the differences amongst ELO ratings of opponents, as well as the total distribution of ELO rankings to see if it is truly uniform. I will also go ahead and plot two histograms representing the distribution of game lengths amongst upsets only, as well as the total distribution of upsets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filtering the pandas dataframe to only see games that ended in an upset</span>
<span class="n">chess_upsets_df</span> <span class="o">=</span> <span class="n">chess_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;UPSET == True&quot;</span><span class="p">)</span>

<span class="c1"># Two lists that will hold total ELO rankings, as well as the difference between ELO amongst opponents</span>
<span class="n">elo_rankings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chess_upsets_df</span><span class="p">[</span><span class="s2">&quot;WHITE_ELO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">chess_upsets_df</span><span class="p">[</span><span class="s2">&quot;BLACK_ELO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
<span class="n">differences</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">chess_upsets_df</span><span class="p">[</span><span class="s2">&quot;WHITE_ELO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span> <span class="o">-</span> <span class="n">chess_upsets_df</span><span class="p">[</span><span class="s2">&quot;BLACK_ELO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
<span class="n">number_of_move_pairs_upsets</span> <span class="o">=</span> <span class="n">chess_upsets_df</span><span class="p">[</span><span class="s2">&quot;NUM_MOVE_PAIRS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_arrow</span><span class="p">()</span><span class="o">.</span><span class="n">to_pylist</span><span class="p">()</span>
<span class="n">number_of_move_pairs</span> <span class="o">=</span> <span class="n">chess_df</span><span class="p">[</span><span class="s2">&quot;NUM_MOVE_PAIRS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_arrow</span><span class="p">()</span><span class="o">.</span><span class="n">to_pylist</span><span class="p">()</span>

<span class="c1"># Configuring multiple histogram plots to display the distribution of ELO rankings and differences</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_figwidth</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">set_figheight</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Histogram of differences between opponent ELOs in Upsets</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">differences</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Difference in Opponent ELO Rankings when an Upset Occurs&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;ELO Ranking&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of Occurrences&quot;</span><span class="p">)</span>

<span class="c1"># Histogram of total distribution of ELO rankings</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">elo_rankings</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Total Distribution of ELO Rankings&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;ELO Ranking&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of Occurrences&quot;</span><span class="p">)</span>

<span class="c1"># Histogram of game lengths in Upsets</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">number_of_move_pairs_upsets</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Length of Game vs. Number of Upsets&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Number of Move Pairs Made During the Game&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of Matches Ending in Upsets&quot;</span><span class="p">)</span>

<span class="c1"># Histogram of total game lengths</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">number_of_move_pairs</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
    <span class="s2">&quot;Total Distribution of Game Lengths Amongst 50,000 Simulations&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Number of Move Pairs Made During the Game&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of Matches&quot;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chess_idea_9_0.png" src="_images/chess_idea_9_0.png" />
</div>
</div>
<p>Based on the plots above, we can confirm that ELO rankings are <em>mostly</em> drawn from a uniform distribution as we specified earlier. But what else is interesting is that it seems the number of upsets decreases exponentially with a larger difference in the ELO rankings of opponents. This makes sense as it is surely more likely that an upset would occur between closely ranked opponents, but nonetheless it can still happen even with differences larger than 2000! The bottom row of charts also helps see if there is a possible correlation between the length of a game and the chances of it becoming an upset. However, as we can see it seems that the distribution of game lengths amongst upsets appears roughly similar to the overall distribution of game lengths, meaning that there does not appear to be a strong correlation between how long a game lasts and whether it will end in an upset.</p>
<p>This also means that there must be some other reason that a chess game can end up in an upset!</p>
<p>Is it that the lower ranked engine produces more randomized moves that aren’t easily predictable? Or perhaps there’s always a chance that the higher skilled engine can make an irreversible blunder?</p>
<p><strong>Piece Possession</strong></p>
<p>Perhaps we can explore the distribution of pieces by the end of a match to see if there is a clear pattern amongst pieces that underdogs obtain at the end of upsets versus their opponents.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">winner_queens</span><span class="p">,</span> <span class="n">winner_kings</span><span class="p">,</span> <span class="n">winner_knights</span><span class="p">,</span> <span class="n">winner_bishops</span><span class="p">,</span> <span class="n">winner_rooks</span><span class="p">,</span> <span class="n">winner_pawns</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">loser_queens</span><span class="p">,</span> <span class="n">loser_kings</span><span class="p">,</span> <span class="n">loser_knights</span><span class="p">,</span> <span class="n">loser_bishops</span><span class="p">,</span> <span class="n">loser_rooks</span><span class="p">,</span> <span class="n">loser_pawns</span> <span class="o">=</span> <span class="p">[</span>
<span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">fen</span><span class="p">,</span> <span class="n">moves_df</span><span class="p">,</span> <span class="n">num_move_pairs</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">winner</span><span class="p">,</span> <span class="n">winner_elo</span><span class="p">,</span> <span class="n">loser_elo</span><span class="p">,</span> <span class="n">upset</span> <span class="ow">in</span> <span class="n">chess_upsets_df</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>

    <span class="k">if</span> <span class="n">winner</span> <span class="o">==</span> <span class="s2">&quot;WHITE&quot;</span><span class="p">:</span>
        <span class="n">winner_queens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">))</span>
        <span class="n">winner_kings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">))</span>
        <span class="n">winner_knights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">))</span>
        <span class="n">winner_bishops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">))</span>
        <span class="n">winner_rooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">))</span>
        <span class="n">winner_pawns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">))</span>

        <span class="n">loser_queens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">))</span>
        <span class="n">loser_kings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">))</span>
        <span class="n">loser_knights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">))</span>
        <span class="n">loser_bishops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">))</span>
        <span class="n">loser_rooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">))</span>
        <span class="n">loser_pawns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">loser_queens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">))</span>
        <span class="n">loser_kings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">))</span>
        <span class="n">loser_knights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">))</span>
        <span class="n">loser_bishops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">))</span>
        <span class="n">loser_rooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">))</span>
        <span class="n">loser_pawns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">))</span>

        <span class="n">winner_queens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">))</span>
        <span class="n">winner_kings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">))</span>
        <span class="n">winner_knights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">))</span>
        <span class="n">winner_bishops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">))</span>
        <span class="n">winner_rooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">))</span>
        <span class="n">winner_pawns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average Number of Pieces Remaining After Upsets:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Queens:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Winner:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">winner_queens</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Loser:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">loser_queens</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Knights:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Winner:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">winner_knights</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Loser:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">loser_knights</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bishops:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Winner:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">winner_bishops</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Loser:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">loser_bishops</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rooks:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Winner:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">winner_rooks</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Loser:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">loser_rooks</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pawns:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Winner:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">winner_pawns</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Loser:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">loser_pawns</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average Number of Pieces Remaining After Upsets:

Queens:
	Winner: 0.9168945428605397
	Loser: 0.26078944239686125
Knights:
	Winner: 0.5448817025323981
	Loser: 0.32350493401498037
Bishops:
	Winner: 0.7590060634882891
	Loser: 0.44958982285102844
Rooks:
	Winner: 1.158066817263108
	Loser: 0.65985019617168
Pawns:
	Winner: 3.2245868505528477
	Loser: 2.69884674830579
</pre></div>
</div>
</div>
</div>
<p><strong>Decision Tree Time!</strong></p>
<p>This section will focus on one method of discovering possible common attributes amongst upsets, and will look to build a model that can output a value representative of who is more likely to win a game at any given board position. Its inputs will include the current board position, who’s turn it is, and the players’ ELO rankings. But first we must create a DataFrame of all our board positions, in a way that a model could understand.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preexisting_data_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;Data/chess_moves_upsets_df.csv&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">preexisting_data_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

    <span class="n">chess_moves_upsets_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="n">chess_upsets_df</span><span class="p">[</span><span class="s2">&quot;WINNER_NUM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chess_upsets_df</span><span class="p">[</span><span class="s2">&quot;WINNER&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s2">&quot;WHITE&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;BLACK&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">})</span>

    <span class="k">for</span> <span class="n">fen</span><span class="p">,</span> <span class="n">moves_df</span><span class="p">,</span> <span class="n">num_move_pairs</span><span class="p">,</span> <span class="n">white_elo</span><span class="p">,</span> <span class="n">black_elo</span><span class="p">,</span> <span class="n">winner_num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chess_upsets_df</span><span class="p">[</span><span class="s2">&quot;FEN&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">chess_upsets_df</span><span class="p">[</span><span class="s2">&quot;MOVES_DF&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">chess_upsets_df</span><span class="p">[</span><span class="s2">&quot;NUM_MOVE_PAIRS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> 
                                                                            <span class="n">chess_upsets_df</span><span class="p">[</span><span class="s2">&quot;WHITE_ELO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">chess_upsets_df</span><span class="p">[</span><span class="s2">&quot;BLACK_ELO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">chess_upsets_df</span><span class="p">[</span><span class="s2">&quot;WINNER_NUM&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()):</span>

        <span class="n">middle_point</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">num_move_pairs</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">winning_moves_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">moves_df</span><span class="p">))[</span><span class="n">middle_point</span><span class="p">:</span><span class="n">middle_point</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">winning_moves_df</span><span class="p">[</span><span class="s2">&quot;WHITE_ELO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">white_elo</span>
        <span class="n">winning_moves_df</span><span class="p">[</span><span class="s2">&quot;BLACK_ELO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">black_elo</span>
        <span class="n">winning_moves_df</span><span class="p">[</span><span class="s2">&quot;WINNER&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">winner_num</span>

        <span class="n">chess_moves_upsets_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">chess_moves_upsets_df</span><span class="p">,</span> <span class="n">winning_moves_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Dropping the index column as it is repetitive</span>
    <span class="n">chess_moves_upsets_df</span> <span class="o">=</span> <span class="n">chess_moves_upsets_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>

    <span class="n">chess_moves_upsets_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;Data/chess_moves_upsets_df.csv&quot;</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
    <span class="n">chess_moves_upsets_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">preexisting_data_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>


<span class="n">chess_moves_upsets_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>FEN_BEFORE_MOVE</th>
      <th>MOVE_MADE</th>
      <th>TURN</th>
      <th>WHITE_ELO</th>
      <th>BLACK_ELO</th>
      <th>WINNER</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1k1r3r/Nb1qn1b1/1p5p/2p1p1pP/2pP4/1P1B2R1/PB1P...</td>
      <td>d4c5</td>
      <td>WHITE</td>
      <td>903</td>
      <td>549</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>8/5p1k/5B1p/1P6/p6p/P2pK3/3P1P2/4R3 b - - 0 46</td>
      <td>h7g6</td>
      <td>BLACK</td>
      <td>1360</td>
      <td>2382</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>3q3r/5r1p/1pB2kp1/pPb2p2/P2p3P/4n1P1/7K/R2Q1R2...</td>
      <td>d1d3</td>
      <td>WHITE</td>
      <td>1494</td>
      <td>277</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>3r1rk1/2Bb2pp/ppn1p1q1/5p2/PPpb4/5BP1/4QP1P/1R...</td>
      <td>c7d8</td>
      <td>WHITE</td>
      <td>1103</td>
      <td>383</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>3r1k2/5p2/1p1N4/6p1/3R4/P2N1K2/1P6/8 b - - 7 39</td>
      <td>b6b5</td>
      <td>BLACK</td>
      <td>674</td>
      <td>1125</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>16817</th>
      <td>16817</td>
      <td>r5k1/1q5p/b3p1p1/4br2/4N1QN/3nR2P/P5P1/3R3K b ...</td>
      <td>b7g7</td>
      <td>BLACK</td>
      <td>1170</td>
      <td>569</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>16818</th>
      <td>16818</td>
      <td>5rk1/2qb1ppp/4pb2/8/R2P1P2/3P4/1P3PBP/3Q1RK1 w...</td>
      <td>a4c4</td>
      <td>WHITE</td>
      <td>1442</td>
      <td>1031</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>16819</th>
      <td>16819</td>
      <td>r3k2r/1b4pp/p1q2n1B/3pp3/1b1P1N1P/2NB3R/1PP2PP...</td>
      <td>e5e4</td>
      <td>BLACK</td>
      <td>931</td>
      <td>1064</td>
      <td>1</td>
    </tr>
    <tr>
      <th>16820</th>
      <td>16820</td>
      <td>r5k1/1r3ppn/4p3/2Q3p1/4P1P1/5P2/7P/2B2RK1 b - ...</td>
      <td>g7g6</td>
      <td>BLACK</td>
      <td>1308</td>
      <td>2206</td>
      <td>1</td>
    </tr>
    <tr>
      <th>16821</th>
      <td>16821</td>
      <td>r2qkb1r/3b4/p1n1ppn1/2Np3p/BP2P1pP/Q1N3B1/P1P2...</td>
      <td>d5d4</td>
      <td>BLACK</td>
      <td>267</td>
      <td>2284</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>16822 rows × 7 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preexisting_data_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;Data/ml_df.csv&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">preexisting_data_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

    <span class="n">piece_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;K&quot;</span><span class="p">:</span> <span class="mi">1000000</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;k&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1000000</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>

    <span class="n">columns_combo</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">([</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="s2">&quot;H&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span> <span class="s2">&quot;7&quot;</span><span class="p">,</span> <span class="s2">&quot;8&quot;</span><span class="p">]))</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">columns_combo</span><span class="p">]</span>
    <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;WHITE_ELO&quot;</span><span class="p">)</span>
    <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;BLACK_ELO&quot;</span><span class="p">)</span>
    <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;WINNER&quot;</span><span class="p">)</span>

    <span class="n">ml_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">fen</span><span class="p">,</span> <span class="n">white_elo</span><span class="p">,</span> <span class="n">black_elo</span><span class="p">,</span> <span class="n">winner_num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chess_moves_upsets_df</span><span class="p">[</span><span class="s2">&quot;FEN_BEFORE_MOVE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">chess_moves_upsets_df</span><span class="p">[</span><span class="s2">&quot;WHITE_ELO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> \
                                                    <span class="n">chess_moves_upsets_df</span><span class="p">[</span><span class="s2">&quot;BLACK_ELO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">chess_moves_upsets_df</span><span class="p">[</span><span class="s2">&quot;WINNER&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()):</span>
                                                    
        <span class="n">squares</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fen</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">new_row</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">col_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">square</span> <span class="ow">in</span> <span class="n">squares</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">square</span><span class="p">)):</span>
                    <span class="n">new_row</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">columns</span><span class="p">[</span><span class="n">col_index</span><span class="p">]:</span><span class="mi">0</span><span class="p">})</span>
                    <span class="n">col_index</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">columns</span><span class="p">[</span><span class="n">col_index</span><span class="p">]:</span><span class="n">piece_map</span><span class="p">[</span><span class="n">square</span><span class="p">]})</span>
                <span class="n">col_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">new_row</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;WHITE_ELO&quot;</span><span class="p">:</span><span class="n">white_elo</span><span class="p">})</span>
        <span class="n">new_row</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;BLACK_ELO&quot;</span><span class="p">:</span><span class="n">black_elo</span><span class="p">})</span>
        <span class="n">new_row</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;WINNER&quot;</span><span class="p">:</span><span class="n">winner_num</span><span class="p">})</span>

        <span class="n">ml_df</span> <span class="o">=</span> <span class="n">ml_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ml_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;Data/ml_df.csv&quot;</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
    <span class="n">ml_df</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">preexisting_data_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">ml_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Unnamed: 0</th>
      <th>A1</th>
      <th>A2</th>
      <th>A3</th>
      <th>A4</th>
      <th>A5</th>
      <th>A6</th>
      <th>A7</th>
      <th>A8</th>
      <th>B1</th>
      <th>...</th>
      <th>H2</th>
      <th>H3</th>
      <th>H4</th>
      <th>H5</th>
      <th>H6</th>
      <th>H7</th>
      <th>H8</th>
      <th>WHITE_ELO</th>
      <th>BLACK_ELO</th>
      <th>WINNER</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>-1000000</td>
      <td>0</td>
      <td>-5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-5</td>
      <td>3</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>1000000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>903</td>
      <td>549</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1360</td>
      <td>2382</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-9</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-5</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>0</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>1494</td>
      <td>277</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-5</td>
      <td>0</td>
      <td>-5</td>
      <td>-1000000</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>1000000</td>
      <td>0</td>
      <td>1103</td>
      <td>383</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-5</td>
      <td>0</td>
      <td>-1000000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>674</td>
      <td>1125</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>16817</th>
      <td>16817</td>
      <td>-5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-1000000</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1000000</td>
      <td>1170</td>
      <td>569</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>16818</th>
      <td>16818</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-5</td>
      <td>-1000000</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>0</td>
      <td>5</td>
      <td>1000000</td>
      <td>0</td>
      <td>1442</td>
      <td>1031</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>16819</th>
      <td>16819</td>
      <td>-5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-1000000</td>
      <td>0</td>
      <td>0</td>
      <td>-5</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
      <td>1000000</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>931</td>
      <td>1064</td>
      <td>1</td>
    </tr>
    <tr>
      <th>16820</th>
      <td>16820</td>
      <td>-5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-1000000</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>1000000</td>
      <td>0</td>
      <td>1308</td>
      <td>2206</td>
      <td>1</td>
    </tr>
    <tr>
      <th>16821</th>
      <td>16821</td>
      <td>-5</td>
      <td>0</td>
      <td>0</td>
      <td>-9</td>
      <td>-1000000</td>
      <td>-3</td>
      <td>0</td>
      <td>-5</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1000000</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
      <td>267</td>
      <td>2284</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>16822 rows × 68 columns</p>
</div></div></div>
</div>
<p><strong>XGBoost</strong></p>
<div class="toctree-wrapper compound">
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>